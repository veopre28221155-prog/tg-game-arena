<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro Snake Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; overflow: hidden; touch-action: none; font-family: sans-serif; }
        canvas { background-color: #000; border: 4px solid #334155; border-radius: 8px; image-rendering: pixelated; width: 100%; max-width: 400px; }
        .btn { user-select: none; background: #334155; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; height: 60px; width: 60px; box-shadow: 0 4px 0 #000; }
        .btn:active { background: #3b82f6; transform: translateY(2px); box-shadow: 0 2px 0 #000; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

    <div class="mb-4 text-2xl font-bold text-yellow-400">Score: <span id="score">0</span></div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="mt-8 grid grid-cols-3 gap-2">
        <div></div>
        <button class="btn" onclick="changeDirection('up')">↑</button>
        <div></div>
        <button class="btn" onclick="changeDirection('left')">←</button>
        <button class="btn" onclick="changeDirection('down')">↓</button>
        <button class="btn" onclick="changeDirection('right')">→</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let score = 0;
        let dx = 0;
        let dy = 0;
        let snake = [{x: 10, y: 10}];
        let food = {x: 5, y: 5};
        let gameSpeed = 100;

        // Основной игровой цикл
        function main() {
            if (didGameEnd()) {
                alert("Игра окончена! Ваш счет: " + score);
                resetGame();
            }

            setTimeout(function onTick() {
                clearCanvas();
                drawFood();
                advanceSnake();
                drawSnake();
                main();
            }, gameSpeed);
        }

        function clearCanvas() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawSnake() {
            ctx.fillStyle = "#4ade80";
            snake.forEach(part => {
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            });
        }

        function advanceSnake() {
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            snake.unshift(head);
            if (snake[0].x === food.x && snake[0].y === food.y) {
                score += 10;
                scoreElement.innerHTML = score;
                createFood();
            } else {
                snake.pop();
            }
        }

        function didGameEnd() {
            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
            }
            const hitLeftWall = snake[0].x < 0;
            const hitRightWall = snake[0].x > tileCount - 1;
            const hitTopWall = snake[0].y < 0;
            const hitBottomWall = snake[0].y > tileCount - 1;
            return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
        }

        function createFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);
        }

        function drawFood() {
            ctx.fillStyle = "#f87171";
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
        }

        function changeDirection(dir) {
            if (dir === 'up' && dy !== 1) { dx = 0; dy = -1; }
            if (dir === 'down' && dy !== -1) { dx = 0; dy = 1; }
            if (dir === 'left' && dx !== 1) { dx = -1; dy = 0; }
            if (dir === 'right' && dx !== -1) { dx = 1; dy = 0; }
        }

        function resetGame() {
            score = 0;
            scoreElement.innerHTML = score;
            snake = [{x: 10, y: 10}];
            dx = 0;
            dy = 0;
            createFood();
        }

        // Управление с клавиатуры
        document.addEventListener("keydown", event => {
            const key = event.keyCode;
            if (key === 37) changeDirection('left');
            if (key === 38) changeDirection('up');
            if (key === 39) changeDirection('right');
            if (key === 40) changeDirection('down');
        });

        createFood();
        main();
    </script>
</body>
</html>
