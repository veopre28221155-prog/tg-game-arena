<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RETRO BATTLE ARENA</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        #gameCanvas { 
            display: block; width: 100vw; height: auto; 
            image-rendering: pixelated; /* Тот самый четкий пиксель */
            background: #2452FF; 
        }
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .active { display: flex; }
        .btn { 
            background: #ff0055; border: 4px solid #fff; color: #fff; 
            padding: 15px 30px; font-weight: bold; cursor: pointer; margin: 10px;
            box-shadow: 5px 5px 0px #550022; text-transform: uppercase;
        }
        #hud { position: absolute; top: 10px; left: 10px; font-size: 20px; color: #FFFF00; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>

<div id="hud" style="display:none;">RINGS: <span id="rings">0</span></div>

<div id="s-menu" class="screen active">
    <h1 style="color:#00f0ff; text-shadow: 4px 4px #ff0055;">RETRO BATTLE ARENA</h1>
    <div class="btn" onclick="launchGame('solo')">Solo Training</div>
    <div class="btn" style="background:#0088ff;" onclick="nav('ranked')">Ranked 1v1</div>
    <p>Balance: <span id="p-bal">0</span></p>
</div>

<div id="s-game" class="screen">
    <canvas id="gameCanvas"></canvas>
    <div style="position:fixed; bottom:20px; width:100%; display:flex; justify-content: space-around;">
        <button class="btn" ontouchstart="press('left', true)" ontouchend="press('left', false)">L</button>
        <button class="btn" ontouchstart="press('jump', true)" ontouchend="press('jump', false)">JUMP</button>
        <button class="btn" ontouchstart="press('right', true)" ontouchend="press('right', false)">R</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 320; canvas.height = 224;
    ctx.imageSmoothingEnabled = false;

    // ФИЗИКА SEGA
    let player = {
        x: 50, y: 150, vx: 0, vy: 0,
        acc: 0.046, fric: 0.046, maxSpd: 6,
        jump: 6.5, grav: 0.21,
        width: 20, height: 30, state: 'idle', dir: 1
    };

    let keys = { left: false, right: false, jump: false };
    function press(k, s) { keys[k] = s; }

    function drawSonic() {
        ctx.save();
        ctx.translate(player.x, player.y);
        if(player.dir === -1) ctx.scale(-1, 1);
        
        // РИСУЕМ СОНИКА (Здесь ИИ отрисует 16-бит спрайт через drawImage или PixelData)
        // Для теста: классический синий шар при прыжке
        if(player.state === 'jump') {
            ctx.fillStyle = '#0000FF';
            ctx.beginPath(); ctx.arc(0, 0, 12, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#FFFFFF'; ctx.lineWidth = 2; ctx.stroke();
        } else {
            // Тот самый Соник (упрощенный пример пикселями, чтобы точно работал)
            ctx.fillStyle = '#0000FF'; ctx.fillRect(-10, -15, 20, 30); // Тело
            ctx.fillStyle = '#FFE4B5'; ctx.fillRect(-5, -5, 10, 10);   // Мордочка
            ctx.fillStyle = '#FFFFFF'; ctx.fillRect(-8, 10, 16, 5);    // Кеды
        }
        ctx.restore();
    }

    function update() {
        // Логика движения Соника с инерцией
        if(keys.left) { player.vx -= player.acc; player.dir = -1; }
        else if(keys.right) { player.vx += player.acc; player.dir = 1; }
        else { player.vx *= 0.95; }

        player.vy += player.grav;
        player.x += player.vx;
        player.y += player.vy;

        if(player.y > 180) { player.y = 180; player.vy = 0; player.state = 'idle'; }
        if(Math.abs(player.vx) > 0.1) player.state = 'run';
        if(player.vy < 0) player.state = 'jump';

        // Рендер фона
        ctx.fillStyle = '#2452FF'; ctx.fillRect(0,0,320,224);
        ctx.fillStyle = '#8B4513'; ctx.fillRect(0,200,320,24); // Земля
        
        drawSonic();
        requestAnimationFrame(update);
    }

    function launchGame(mode) {
        document.getElementById('s-menu').classList.remove('active');
        document.getElementById('s-game').classList.add('active');
        update();
    }
</script>
</body>
</html>
